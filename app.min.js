/* MiniCRM v2 minimal boot (safe) */
(()=>{"use strict";window.__MiniCRMv2BootOK=!0;const e=(e,t=document)=>t.querySelector(e),t=e=>document.getElementById(e),n=e=>new Intl.NumberFormat("ru-RU").format(Math.round(Number(e||0)))+" ‚ÇΩ",o=e=>Math.ceil(e/864e5),a=e=>{const t=+e.labor||0,o=+e.parts||0,a=+e.paid||0,c=t+o,s=Math.max(0,c-a),d=e.dueAt?+e.dueAt:e.createdAt?+e.createdAt+2592e5:Date.now(),r=s>0&&Date.now()>d?o(Date.now()-d):0;return{total:c,debt:s,dueAt:d,overdueDays:r}},c=e=>{const t=a(e),o=(e.phone||"").replace(/[^\d+]/g,""),c="done"===e.status?"dim-done":t.debt>0?"glow-red":"glow-green",s=t.debt>0?`‚Ä¢ –ü—Ä–æ—Å—Ä–æ—á–∫–∞: ${t.overdueDays} –¥–Ω.`:"‚Ä¢ –ë–µ–∑ –ø—Ä–æ—Å—Ä–æ—á–∫–∏",d="‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ".split("").map(((t,n)=>`<span class="star ${n<(e.rating||0)?"filled":""}">‚òÖ</span>`)).join("");return `
    <div class="card ${c}" data-id="${e.id}">
      <div class="row">
        <div class="title">${e.name} <span class="muted">${e.id}</span></div>
        <div class="stars" aria-hidden="true">${d}</div>
      </div>
      <div class="row small" style="margin-top:6px">
        <a class="phone" href="tel:${o}">üìû ${e.phone||""}</a>
        <span>‚Ä¢ ${e.device||""}</span>
        <span>${s}</span>
      </div>
      <div class="chips">
        <span class="chip">–†–∞–±–æ—Ç–∞: ${n(e.labor||0)}</span>
        <span class="chip">–î–µ—Ç–∞–ª–∏: ${n(e.parts||0)}</span>
        <span class="chip"><b>–ò—Ç–æ–≥–æ: ${n(t.total)}</b></span>
        ${t.debt>0?`<span class="chip bad"><b>–î–æ–ª–≥: ${n(t.debt)}</b></span>`:`<span class="chip ok">–û–ø–ª–∞—á–µ–Ω–æ: ${n(e.paid||0)}</span>`}
        <span class="chip ${"done"===e.status?"ok":"warn"}">${"done"===e.status?"–ó–∞–≤–µ—Ä—à—ë–Ω":"–í —Ä–∞–±–æ—Ç–µ"}</span>
      </div>
    </div>`};!function(){const o=t("app");o&&(o.innerHTML=`
    <div class="header">
      <div class="brand"><div class="dot"></div><h1>MiniCRM v2 ‚Äî –º–∞—Å—Ç–µ—Ä—Å–∫–∞—è</h1></div>
      <div class="right"><div class="badge" id="stat">0 –∫–ª–∏–µ–Ω—Ç–æ–≤</div></div>
    </div>
    <div class="tabs" id="tabs">
      <button class="tab active" data-page="home">–ì–ª–∞–≤–Ω–∞—è</button>
      <button class="tab" data-page="debts">–ü—Ä–æ—Å—Ä–æ—á–∫–∞</button>
      <button class="tab" data-page="work">–í —Ä–∞–±–æ—Ç–µ</button>
      <button class="tab" data-page="done">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</button>
      <button class="tab" data-page="about">–û –ø—Ä–æ–≥—Ä–∞–º–º–µ</button>
    </div>
    <div class="pages" id="pages">
      <section class="page active" id="page-home">
        <div class="kpis" id="home-kpis"></div>
        <div id="home-list"></div>
      </section>
      <section class="page" id="page-debts"><div id="debts-summary"></div><div id="debts-list"></div></section>
      <section class="page" id="page-work"><div id="work-list"></div></section>
      <section class="page" id="page-done"><div id="done-list"></div></section>
      <section class="page" id="page-about">
        <div class="card"><div class="title">–£–≥—Ä–∞–†–µ–º–ö–æ–º–ø ‚Äî MiniCRM v2</div>
          <div class="small">–õ—ë–≥–∫–∞—è —Å–±–æ—Ä–∫–∞ –¥–ª—è GitHub Pages.</div></div>
      </section>
    </div>
    <div class="navbar" id="navbar">
      <div class="navrow">
        <button class="navbtn active" data-page="home">–ì–ª–∞–≤–Ω–∞—è</button>
        <button class="navbtn" data-page="debts">–ü—Ä–æ—Å—Ä–æ—á–∫–∞</button>
        <button class="navbtn" data-page="work">–í —Ä–∞–±–æ—Ç–µ</button>
        <button class="navbtn" data-page="about">–û –ø—Ä–æ–≥—Ä.</button>
      </div>
    </div>
  `);const s=()=>{const e=JSON.parse(localStorage.getItem("mcrm.demo")||"[]"),o=t("stat");if(o){let t=0,r=0,l=0,i=0;e.forEach((e=>{const t=a(e);l+=t.debt,r+=+e.paid||0,"work"===e.status&&(i+=1)})),o.textContent=`${e.length} ‚Ä¢ –¥–æ–ª–≥ ${n(l)} ‚Ä¢ –≤ —Ä–∞–±–æ—Ç–µ ${i}`}const d=t("home-list"),m=t("debts-summary"),p=t("debts-list"),h=t("work-list"),g=t("done-list");if(d){const t=[...e].sort(((e,t)=>{const n=a(e),o=a(t),c=n.debt>0,s=o.debt>0;return c!==s?(s?1:0)-(c?1:0):c&&s?o.overdueDays-n.overdueDays:e.status!==t.status?"work"===e.status?-1:1:(t.createdAt||0)-(e.createdAt||0)}));d.innerHTML=t.map(c).join("")||'<div class="card"><div class="muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –î–æ–±–∞–≤—å—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞.</div></div>'}if(m&&p){const t=e.filter((e=>a(e).debt>0)),o=t.reduce(((e,t)=>e+a(t).debt),0);m.innerHTML=`<div class="card glow-red"><div class="title">–ü—Ä–æ—Å—Ä–æ—á–∫–∞ ‚Äî —Å–≤–æ–¥–∫–∞</div><div class="chips"><span class="chip bad">–í—Å–µ–≥–æ –¥–æ–ª–≥: ${n(o)}</span><span class="chip">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${t.length}</span></div></div>`,p.innerHTML=t.map(c).join("")||'<div class="card"><div class="muted">–ù–µ—Ç –¥–æ–ª–∂–Ω–∏–∫–æ–≤ üéâ</div></div>'}h&&(h.innerHTML=e.filter((e=>"work"===e.status)).map(c).join("")||'<div class="card"><div class="muted">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∞–±–æ—Ç</div></div>'),g&&(g.innerHTML=e.filter((e=>"done"===e.status)).map(c).join("")||'<div class="card"><div class="muted">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö</div></div>')};if(!localStorage.getItem("mcrm.demo")){const e=Date.now(),t=[{id:"#100123",name:"–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",phone:"+7 900 111-22-33",device:"iPhone 11",labor:3500,parts:4500,paid:2e3,status:"work",createdAt:e-2592e5},{id:"#100124",name:"–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞",phone:"+7 999 222-33-44",device:"Redmi Note 10",labor:2500,parts:1800,paid:4300,status:"done",createdAt:e-864e5},{id:"#100125",name:"–ê–Ω–¥—Ä–µ–π –ö.",phone:"+7 988 777-55-44",device:"Realme C61",labor:3e3,parts:0,paid:0,status:"work",createdAt:e-6912e5,dueAt:e-1728e5}];localStorage.setItem("mcrm.demo",JSON.stringify(t))}s(),e("#tabs")&&e("#tabs").addEventListener("click",(t=>{const n=t.target.closest("[data-page]");if(!n)return;const o=n.getAttribute("data-page");document.querySelectorAll(".tab").forEach((e=>e.classList.toggle("active",e.dataset.page===o))),document.querySelectorAll(".navbtn").forEach((e=>e.classList.toggle("active",e.dataset.page===o))),document.querySelectorAll(".page").forEach((e=>e.classList.toggle("active",e.id===`page-${o}`))),"home"!==o&&"debts"!==o&&"work"!==o&&"done"!==o||s()}))}})();
